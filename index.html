
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>odsclient</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#odsclient" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="odsclient" class="md-header-nav__button md-logo" aria-label="odsclient">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            odsclient
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/smarie/python-odsclient/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="odsclient" class="md-nav__button md-logo" aria-label="odsclient">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    odsclient
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/smarie/python-odsclient/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="." class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basics" class="md-nav__link">
    1. Basics
  </a>
  
    <nav class="md-nav" aria-label="1. Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-downloading-a-flat-dataset" class="md-nav__link">
    a- Downloading a "flat" dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-using-another-ods-platform" class="md-nav__link">
    b- Using another ODS platform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-declaring-an-api-key" class="md-nav__link">
    c- Declaring an API key
  </a>
  
    <nav class="md-nav" aria-label="c- Declaring an API key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explicit-temporary" class="md-nav__link">
    explicit, temporary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interactive" class="md-nav__link">
    interactive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permanent" class="md-nav__link">
    permanent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-pushing-a-dataset-realtime-api" class="md-nav__link">
    d- Pushing a dataset (Realtime API)
  </a>
  
    <nav class="md-nav" aria-label="d- Pushing a dataset (Realtime API)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pushing-a-csv" class="md-nav__link">
    Pushing a CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pushing-a-dataframe" class="md-nav__link">
    Pushing a DataFrame
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-advanced" class="md-nav__link">
    2. Advanced
  </a>
  
    <nav class="md-nav" aria-label="2. Advanced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-caching" class="md-nav__link">
    a. Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="odskey/" class="md-nav__link">
      odskey command
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="api_reference/" class="md-nav__link">
      API reference
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="changelog/" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basics" class="md-nav__link">
    1. Basics
  </a>
  
    <nav class="md-nav" aria-label="1. Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-downloading-a-flat-dataset" class="md-nav__link">
    a- Downloading a "flat" dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-using-another-ods-platform" class="md-nav__link">
    b- Using another ODS platform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-declaring-an-api-key" class="md-nav__link">
    c- Declaring an API key
  </a>
  
    <nav class="md-nav" aria-label="c- Declaring an API key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explicit-temporary" class="md-nav__link">
    explicit, temporary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interactive" class="md-nav__link">
    interactive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permanent" class="md-nav__link">
    permanent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-pushing-a-dataset-realtime-api" class="md-nav__link">
    d- Pushing a dataset (Realtime API)
  </a>
  
    <nav class="md-nav" aria-label="d- Pushing a dataset (Realtime API)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pushing-a-csv" class="md-nav__link">
    Pushing a CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pushing-a-dataframe" class="md-nav__link">
    Pushing a DataFrame
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-advanced" class="md-nav__link">
    2. Advanced
  </a>
  
    <nav class="md-nav" aria-label="2. Advanced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-caching" class="md-nav__link">
    a. Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-odsclient/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="odsclient">odsclient<a class="headerlink" href="#odsclient" title="Permanent link">&para;</a></h1>
<p><em>A nonofficial client for OpenDataSoft API.</em></p>
<p><a href="https://pypi.python.org/pypi/odsclient/"><img alt="Python versions" src="https://img.shields.io/pypi/pyversions/odsclient.svg" /></a> <a href="https://travis-ci.com/smarie/python-odsclient"><img alt="Build Status" src="https://travis-ci.com/smarie/python-odsclient.svg?branch=master" /></a> <a href="https://smarie.github.io/python-odsclient/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-odsclient/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-odsclient"><img alt="codecov" src="https://codecov.io/gh/smarie/python-odsclient/branch/master/graph/badge.svg" /></a></p>
<p><a href="https://smarie.github.io/python-odsclient/"><img alt="Documentation" src="https://img.shields.io/badge/doc-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/odsclient/"><img alt="PyPI" src="https://img.shields.io/pypi/v/odsclient.svg" /></a> <a href="https://pepy.tech/project/odsclient"><img alt="Downloads" src="https://pepy.tech/badge/odsclient" /></a> <a href="https://pepy.tech/project/odsclient"><img alt="Downloads per week" src="https://pepy.tech/badge/odsclient/week" /></a> <a href="https://github.com/smarie/python-odsclient/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/smarie/python-odsclient.svg" /></a></p>
<div class="admonition success">
<p class="admonition-title">New: you can now use a local file cache ! Check it out <a href="#a-caching">below</a>.</p>
</div>
<div class="admonition success">
<p class="admonition-title">New: stream-download huge datasets to csv files directly, and use <code>tqdm</code> progress bars !</p>
</div>
<p><code>odsclient</code> provides a minimal set of functions to grab a dataset or a collection of datasets from an OpenDataSoft (ODS) platform. </p>
<p>Its initial purpose is not to cover the <a href="https://help.opendatasoft.com/en/apis/">full set of APIs available</a> but to get a minimum viable set of features to work easily with the datasets.</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>&gt; pip install odsclient
</code></pre></div>


<p>Optional:</p>
<ul>
<li>If you wish to display progress bars, you should also install <code>tqdm</code>.</li>
<li>If you wish to download datasets as dataframes, you should also install <code>pandas</code>. </li>
</ul>
<p>Finally, if you plan to use api keys, we recommend that you install <code>keyring</code> as it will help you store the critical api keys in your operating system's password vault.</p>
<div class="codehilite"><pre><span></span><code>&gt; pip install keyring
</code></pre></div>


<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<h3 id="1-basics">1. Basics<a class="headerlink" href="#1-basics" title="Permanent link">&para;</a></h3>
<h4 id="a-downloading-a-flat-dataset">a- Downloading a "flat" dataset<a class="headerlink" href="#a-downloading-a-flat-dataset" title="Permanent link">&para;</a></h4>
<p>The most basic thing that you can do is to download a whole dataset, similarly to what you can get when clicking on the links with your browser on a dataset's <a href="https://public.opendatasoft.com/explore/dataset/opendatasoft-offices/export/">"Export" page</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">get_whole_dataset</span>

<span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;evolution-trafic-de-voyageurs-reseaux-ferres-france-2010-2014&quot;</span><span class="p">,</span> 
                            <span class="n">platform_id</span><span class="o">=</span><span class="s1">&#39;public&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">csv_str</span><span class="p">)</span>
</code></pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><code><span class="err">Transport;Année;Millions de Voyageurs</span>
<span class="err">SNCF - Trains/RER (y compris T4);2013;12103</span>
<span class="err">RATP - Métro;2011;5022</span>
<span class="err">RATP - RER;2010;7486</span>
<span class="err">...</span>
</code></pre></div>


<p>In addition:</p>
<ul>
<li>
<p>you might wish to display a progress bar using <code>tqdm=True</code> (<code>pip install tqdm</code> first). Note that on some ODS platforms the HTTP Header <code>Content-Length</code> is not set, so you might only see a download rate, not an actual progress bar.</p>
</li>
<li>
<p>you might wish to download directly the dataset to a csv using streaming and without loading it in memory. This can be achieved by setting <code>to_path=&lt;path&gt;</code> where the path can be a string or a <code>pathlib.Path</code> instance.</p>
</li>
</ul>
<p>Finally, if you have <code>pandas</code> installed, you can get the dataset directly as a dataframe:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">get_whole_dataframe</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">get_whole_dataframe</span><span class="p">(</span><span class="s2">&quot;evolution-trafic-de-voyageurs-reseaux-ferres-france-2010-2014&quot;</span><span class="p">,</span> 
                         <span class="n">platform_id</span><span class="o">=</span><span class="s1">&#39;public&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><code><span class="err">                          Transport   Année  Millions de Voyageurs</span>
<span class="err">0  SNCF - Trains/RER (y compris T4)  2013.0                12103.0</span>
<span class="err">1                      RATP - Métro  2011.0                 5022.0</span>
<span class="err">2                        RATP - RER  2010.0                 7486.0</span>
<span class="err">3                        RATP - RER     NaN                    NaN</span>
<span class="err">4  SNCF - Trains/RER (y compris T4)     NaN                    NaN</span>
</code></pre></div>


<h4 id="b-using-another-ods-platform">b- Using another ODS platform<a class="headerlink" href="#b-using-another-ods-platform" title="Permanent link">&para;</a></h4>
<p>By default the base url used to access the OpenDataSoft platform is <code>https://&lt;platform_id&gt;.opendatasoft.com</code>, with <code>platform_id='public'</code>. In the methods above, you can change either the platform id with <code>platform_id=...</code> if your target ODS platform has a standard host name, or the entire base url with <code>base_url=...</code>.</p>
<p>If you wish to check the result without executing the method, you can create an <code>ODSClient</code> object with the same parameters and inspect its <code>&lt;client&gt;.base_url</code> :</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">ODSClient</span>

<span class="n">default_client</span> <span class="o">=</span> <span class="n">ODSClient</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default:               </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">default_client</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>

<span class="n">client_with_custom_pfid</span> <span class="o">=</span> <span class="n">ODSClient</span><span class="p">(</span><span class="n">platform_id</span><span class="o">=</span><span class="s1">&#39;my_ods&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom `platform_id`:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client_with_custom_pfid</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>

<span class="n">client_with_custom_baseurl</span> <span class="o">=</span> <span class="n">ODSClient</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://my_ods_server.com/&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom `base_url`:     </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client_with_custom_baseurl</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
</code></pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><code><span class="k">Default</span><span class="o">:</span>               <span class="n">https</span><span class="o">://</span><span class="n">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span>
<span class="n">Custom</span> <span class="n n-Quoted">`platform_id`</span><span class="o">:</span>  <span class="n">https</span><span class="o">://</span><span class="n">my_ods</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span>
<span class="n">Custom</span> <span class="n n-Quoted">`base_url`</span><span class="o">:</span>     <span class="n">https</span><span class="o">://</span><span class="n">my_ods_server</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>


<p>Note that any trailing slash is automatically removed from custom base urls.</p>
<h4 id="c-declaring-an-api-key">c- Declaring an API key<a class="headerlink" href="#c-declaring-an-api-key" title="Permanent link">&para;</a></h4>
<p>Most ODS servers require some sort of authentication to access some of their contents. <code>odsclient</code> supports authentication through API keys (see <a href="https://help.opendatasoft.com/en/apis/">ODS API Documentation</a>). There are several ways that you can use to specify an api key to use for your ODS interactions.</p>
<h5 id="explicit-temporary">explicit, temporary<a class="headerlink" href="#explicit-temporary" title="Permanent link">&para;</a></h5>
<p>If your need is a "quick and dirty" test, you can use direct <code>apikey=...</code> argument passing. This is the <strong>most insecure</strong> way of all, since your code will contain the key as a readable string. It should only be used as a temporary workaround, and should never be committed with the source code.</p>
<div class="codehilite"><pre><span></span><code><span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;world-growth-since-the-industrial-revolution0&quot;</span><span class="p">,</span> 
                            <span class="n">apikey</span><span class="o">=</span><span class="s2">&quot;my_non_working_api_key&quot;</span><span class="p">)</span>
</code></pre></div>


<h5 id="interactive">interactive<a class="headerlink" href="#interactive" title="Permanent link">&para;</a></h5>
<p>If your application tolerates user interaction through the terminal, you can make the above more secure by using <a href="https://docs.python.org/3/library/getpass.html"><code>getpass()</code></a> so that users are prompted for the api key at runtime:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;world-growth-since-the-industrial-revolution0&quot;</span><span class="p">,</span> 
                            <span class="n">apikey</span><span class="o">=</span><span class="n">getpass</span><span class="p">())</span>
</code></pre></div>


<h5 id="permanent">permanent<a class="headerlink" href="#permanent" title="Permanent link">&para;</a></h5>
<p>In all other cases, we recommend that you write apikey-agnostic code such as the one below:</p>
<div class="codehilite"><pre><span></span><code><span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;world-growth-since-the-industrial-revolution0&quot;</span><span class="p">)</span>
</code></pre></div>


<p>In that case, <code>odsclient</code> will try several strategies to find an api key:</p>
<ul>
<li>
<p>first it will look for an <code>ods.apikey</code> text file containing the api key. The file should obviously not be committed with the source code (use <code>.gitignore</code> !). This is not the most secure solution, as malicious programs on your computer may have access to the file, and moreover you may commit it by accident (human error prone). You can override the default file path with the <code>apikey_filepath=...</code> argument.</p>
</li>
<li>
<p>then if <code>keyring</code> is installed (<code>pip install keyring</code>), it will check if there is an entry in it for service <code>&lt;base_url&gt;</code> and username <code>'apikey_user'</code>. <code>keyring</code> leverages your OS' vault (<a href="https://keyring.readthedocs.io/en/latest/?badge=latest#what-is-python-keyring-lib">Windows Credential Locker, macOS Keychain, Ubuntu SecretService, GNOME Keyring, etc.</a>). <strong>This is the most secure method available, it is therefore highly recommended</strong>. You can override the default keyring entry username with the <code>keyring_entries_username=...</code> argument. You can easily add or remove an entry in the keyring with the <a href="odskey/"><code>odskeys</code> commandline utility</a>, through the OS interface, or with the <code>store_apikey_in_keyring</code> / <code>get_apikey_from_keyring</code> / <code>remove_apikey_from_keyring</code> python API provided in <code>odsclient</code>.</p>
</li>
<li>
<p>finally it looks for an <code>ODS_APIKEY</code> OS environment variable. This environment variable should either contain a single api key without quotes (e.g. <code>aef46reohln48</code>), or a dict-like structure where keys can either be <code>&lt;platform_id&gt;</code>, <code>&lt;base_url&gt;</code>, or the special fallback key <code>'default'</code> (e.g. <code>{'public': 'key2', 'https://myods.com': 'key3', 'default': 'key1'}</code>). This method is not the most secure solution because malicious programs can access the OS environment variables ; however it should be preferred over the file-based method as it is not human error-prone. Besides it can be handy for continuous integration jobs.</p>
</li>
</ul>
<p>If you wish to <strong>force</strong> usage of an api key (and prevent any ODS query to be made if none is found), you may wish to set <code>enforce_apikey=True</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;world-growth-since-the-industrial-revolution0&quot;</span><span class="p">,</span>
                            <span class="n">enforce_apikey</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># raise if no apikey is found</span>
                            <span class="p">)</span>
</code></pre></div>


<p>If no api key is found, the above yields:</p>
<div class="codehilite"><pre><span></span><code><span class="n">odsclient</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">NoODSAPIKeyFoundError</span><span class="o">:</span> <span class="n">ODS</span> <span class="n">API</span> <span class="k">key</span> <span class="k">file</span> <span class="k">not</span> <span class="k">found</span><span class="p">,</span> <span class="k">while</span> <span class="n">it</span> <span class="k">is</span> 
    <span class="n">marked</span> <span class="k">as</span> <span class="n">mandatory</span> <span class="k">for</span> <span class="n">this</span> <span class="k">call</span> <span class="p">(</span><span class="n n-Quoted">`enforce_apikey=True`</span><span class="p">).</span> <span class="n">It</span> <span class="n">should</span> <span class="n">either</span> 
    <span class="n">be</span> <span class="n">put</span> <span class="k">in</span> <span class="n">a</span> <span class="kt">text</span> <span class="k">file</span> <span class="k">at</span> <span class="k">path</span> <span class="s1">&#39;ods.apikey&#39;</span><span class="p">,</span> <span class="k">or</span> <span class="k">in</span> <span class="n">the</span> <span class="n n-Quoted">`ODS_APIKEY`</span> <span class="n">OS</span> 
    <span class="n">environment</span> <span class="n">variable</span><span class="p">,</span> <span class="k">or</span> <span class="p">(</span><span class="n">recommended</span><span class="p">,</span> <span class="n">most</span> <span class="n">secure</span><span class="p">)</span> <span class="k">in</span> <span class="n">the</span> <span class="k">local</span> <span class="n n-Quoted">`keyring`</span><span class="p">.</span>
    <span class="n">See</span> <span class="n">documentation</span> <span class="k">for</span> <span class="n">details</span><span class="o">:</span> 
    <span class="n">https</span><span class="o">://</span><span class="n">smarie</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="k">io</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">odsclient</span><span class="o">/</span><span class="c1">#c-declaring-an-api-key. </span>
    <span class="n">Note</span> <span class="n">that</span> <span class="n">you</span> <span class="n">can</span> <span class="n">generate</span> <span class="n">an</span> <span class="n">API</span> <span class="k">key</span> <span class="k">on</span> <span class="n">this</span> <span class="n">web</span> <span class="k">page</span><span class="o">:</span> <span class="err">[</span><span class="p">...</span><span class="err">]</span><span class="p">.</span>
</code></pre></div>


<p>This can be handy if you wish your users to see a quick help at first call reminding them on the various ways to provide an api key.</p>
<p>Finally, for debugging purposes, you may wish to use <code>get_apikey()</code> to check if the api key that is actually used is the one you think you have configured (through a file, env variable, or keyring):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">get_apikey</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;api key used: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">get_apikey</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://my_ods_server.com/&quot;</span><span class="p">))</span>
</code></pre></div>


<h4 id="d-pushing-a-dataset-realtime-api">d- Pushing a dataset (Realtime API)<a class="headerlink" href="#d-pushing-a-dataset-realtime-api" title="Permanent link">&para;</a></h4>
<p>Pushing new data to the <em>Realtime</em> API of ODS works through the <code>push_dataset_realtime</code> function.
In order to push data you need to get a pushkey for your dataset at the <em>Sources</em> tab
on the dataset definition page in order to get this work.</p>
<div class="admonition warning">
<p class="admonition-title">The pushkey is independent from your API key. Passing your API key as the pushkey won't work.</p>
</div>
<p>You can push the data as CSV or as a <code>pandas</code> dataframe, as shown below.</p>
<h5 id="pushing-a-csv">Pushing a CSV<a class="headerlink" href="#pushing-a-csv" title="Permanent link">&para;</a></h5>
<p>The simplest way to push a dataset is to provide a string following the CSV format:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">ODSClient</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">ODSClient</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;ODS-platform-id&gt;&gt;&#39;</span><span class="p">)</span>

<span class="n">csv</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;column_1,column_2</span>
<span class="s2">1,2</span>
<span class="s2">3,4</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">push_dataset_realtime</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;dataset-id&gt;&gt;&#39;</span><span class="p">,</span>
                              <span class="n">csv</span><span class="p">,</span>
                              <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
                              <span class="n">csv_separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                              <span class="n">push_key</span><span class="o">=</span><span class="s1">&#39;&lt;&lt;your-push-key&gt;&gt;&#39;</span><span class="p">)</span>
</code></pre></div>


<h5 id="pushing-a-dataframe">Pushing a DataFrame<a class="headerlink" href="#pushing-a-dataframe" title="Permanent link">&para;</a></h5>
<p>If you have <code>pandas</code> installed you can also push a <code>DataFrame</code> directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">odsclient</span> <span class="kn">import</span> <span class="n">ODSClient</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">ODSClient</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;ODS-platform-id&gt;&gt;&#39;</span><span class="p">)</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
<span class="p">]</span>
<span class="n">p_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">push_dataset_realtime</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;dataset-id&gt;&gt;&quot;</span><span class="p">,</span>
                              <span class="n">p_df</span><span class="p">,</span>
                              <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span>
                              <span class="n">push_key</span><span class="o">=</span><span class="s1">&#39;&lt;&lt;your-push-key&gt;&gt;&#39;</span><span class="p">)</span>
</code></pre></div>


<p>See <a href="api_reference/">API reference</a> for details.</p>
<h3 id="2-advanced">2. Advanced<a class="headerlink" href="#2-advanced" title="Permanent link">&para;</a></h3>
<h4 id="a-caching">a. Caching<a class="headerlink" href="#a-caching" title="Permanent link">&para;</a></h4>
<p>If you use some datasets often, you might not wish to make a query to the ODS platform everytime your code runs. To avoid useless calls, you can now use the <code>file_cache</code> argument, in any of the dataset retrieval methods. It can either receive a path-like object indicating the folder to use as the cache root, or a boolean (<code>True</code> means <code>.odsclient/</code>, <code>False</code> means cache disabled).</p>
<div class="codehilite"><pre><span></span><code><span class="n">csv_str</span> <span class="o">=</span> <span class="n">get_whole_dataset</span><span class="p">(</span><span class="s2">&quot;opendatasoft-offices&quot;</span><span class="p">,</span> <span class="n">file_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


<p>You should see the following file created:</p>
<p><img alt="cache_fs" src="./imgs/cache1.png" /></p>
<p>The next usage of this dataset (through <code>get_whole_dataset</code> or through <code>get_whole_dataframe</code>) will not make a network call and will instead reuse this local file.</p>
<p>In addition you have access to two utility methods : </p>
<ul>
<li>
<p><code>clean_cache</code> cleans parts or all of the cache. Note that this is equivalent to removing the folders/files by hand, so you can do this too.</p>
</li>
<li>
<p><code>get_cached_dataset_entry</code> or <code>&lt;ODSClient&gt;.get_cached_dataset_entry</code> returns a <code>CacheEntry</code> object representing the cached file. This object contains its path and provides handy methods to read and write the file.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">All files in the cache are converted to <code>utf-8</code> encoding</p>
<p>In order to avoid storing encoding information in the cache folder, <code>odsclient</code> converts all downloaded datasets to <code>utf-8</code> encoding before storing them in the cache. This should have no side-effect for you except if you try to read the cached file directly without using the <code>CacheEntry.read()</code> method, or if your dataset contains <a href="https://en.wikipedia.org/wiki/Unicode#Issues">old/alternative forms of east asian kanji</a> that cannot be represented with unicode encodings.</p>
</div>
<h2 id="main-features-benefits">Main features / benefits<a class="headerlink" href="#main-features-benefits" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Simple access to ODS API to retrive a whole dataset as text (csv) or dataframe</p>
</li>
<li>
<p>Support for many methods to define an api key, independently of the source code: different users may use different methods (env variable, api key file, keyring) while using the same odsclient code.</p>
</li>
<li>
<p>Easy-to-use caching capabilities on the local disk.</p>
</li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<p>This library was inspired by:</p>
<ul>
<li><a href="https://smarie.github.io/python-azureml-client/"><code>azmlclient</code></a></li>
<li><a href="https://pypi.org/project/keyring/"><code>keyring</code></a></li>
<li>Work in progress: using KeePass as a <code>keyring</code> backend. <a href="https://github.com/brettviren/python-keepass">Here</a> and <a href="https://github.com/jaraco/keyring/issues/14">here</a></li>
</ul>
<h3 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h3>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie/OVERVIEW#python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-odsclient">https://github.com/smarie/python-odsclient</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="odskey/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                odskey command
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"search.result.term.missing": "Missing", "search.result.none": "No matching documents", "search.result.other": "# matching documents", "clipboard.copied": "Copied to clipboard", "search.result.placeholder": "Type to start searching", "search.result.one": "1 matching document", "search.result.more.other": "# more on this page", "search.result.more.one": "1 more on this page", "search.placeholder": "Search", "search.config.separator": "[\\s\\-]+", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>